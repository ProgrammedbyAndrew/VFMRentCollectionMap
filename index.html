<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Visitors Flea Market Rent Collection Map</title>
  <style>
    body {
      margin: 0; 
      padding: 0;
      font-family: sans-serif;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
    }

    /* Legend */
    #legend {
      margin: 1rem;
      font-size: 14px;
    }
    #legend h3 {
      margin: 0 0 0.5rem 0;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 0.3rem;
    }
    .color-box {
      width: 20px;
      height: 20px;
      margin-right: 8px;
      border: 2px solid #333; 
      box-sizing: border-box;
    }
    .color-outline-red {
      background-color: #fff;
      border-color: red;
    }

    /* The container for the map plane */
    #mapContainer {
      position: relative;
      margin: 0 auto;
      border: 2px solid #ccc;
      background: #fff;
    }

    .booth {
      position: absolute;
      border: 2px solid #333; 
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 12px;
      color: #000;
      overflow: hidden; 
      cursor: pointer; /* clickable booths now */
    }
  </style>
</head>
<body>

<h1>Visitors Flea Market Rent Collection Map</h1>

<div id="legend">
  <h3>Legend</h3>
  <div class="legend-item">
    <div class="color-box" style="background-color:#FF9999;"></div> 
    <span>Past Due (No Payment This Week)</span>
  </div>
  <div class="legend-item">
    <!-- White background, red border -->
    <div class="color-box" style="background-color:#fff; border-color:red;"></div>
    <span>Past Due (Paid This Week)</span>
  </div>
  <div class="legend-item">
    <div class="color-box" style="background-color:#99FF99;"></div>
    <span>Paid (No Past Due)</span>
  </div>
  <div class="legend-item">
    <div class="color-box" style="background-color:#ccc;"></div>
    <span>Vacant Booth</span>
  </div>
  <div class="legend-item">
    <div class="color-box" style="background-color:#666; border-color:#444;"></div>
    <span>Pantry</span>
  </div>
  <div class="legend-item">
    <div class="color-box" style="background-color:#99CCFF;"></div>
    <span>Company Storage</span>
  </div>
</div>

<div id="mapContainer"></div>

<script>
// We'll fetch the JSON from "map_layout.json"
fetch('map_layout.json')
  .then(response => {
    if(!response.ok) {
      throw new Error("Failed to load map_layout.json: " + response.status);
    }
    return response.json();
  })
  .then(mapData => {
    // Once loaded, display the map
    initMap(mapData);
  })
  .catch(err => {
    console.error("Error loading map_layout.json:", err);
    alert("Error loading map_layout.json. See console.");
  });


/*
  We'll define a set of 6 statuses with pastel or lighter backgrounds
  so black text is readable:

  1) Past Due (No Payment)       => #FF9999  (light red)
  2) Past Due (Paid This Week)   => #fff with border-color:red
  3) Paid (No Past Due)          => #99FF99  (light green)
  4) Vacant                      => #ccc     (gray)
  5) Pantry                      => #666 with border-color:#444, text is black => not great, so we can do text color white if it's #666
  6) Company Storage             => #99CCFF  (light blue)
*/
const STATUSES = [
  { background: "#FF9999", border: "#333", text:"#000" }, // Past Due (No Payment)
  { background: "#fff",    border: "red",  text:"#000" }, // Past Due (Paid)
  { background: "#99FF99", border: "#333", text:"#000" }, // Paid, no past due
  { background: "#ccc",    border: "#333", text:"#000" }, // Vacant
  { background: "#666",    border: "#444", text:"#fff" }, // Pantry (use white text)
  { background: "#99CCFF", border: "#333", text:"#000" }  // Company storage
];

// Return a random status from STATUSES
function randomStatus() {
  return STATUSES[Math.floor(Math.random() * STATUSES.length)];
}

function initMap(mapData){
  // 1) Create container sized to planeWidth & planeHeight
  const container = document.getElementById("mapContainer");
  container.style.width  = mapData.planeWidth + "px";
  container.style.height = mapData.planeHeight+ "px";

  // 2) For each booth in the JSON, create a booth div
  mapData.booths.forEach(boothData => {
    const boothDiv = document.createElement("div");
    boothDiv.className = "booth";

    // Position & size
    boothDiv.style.left   = boothData.x + "px";
    boothDiv.style.top    = boothData.y + "px";
    boothDiv.style.width  = boothData.width  + "px";
    boothDiv.style.height = boothData.height + "px";

    // Label text
    boothDiv.textContent = boothData.label;

    // 3) Random status color
    const status = randomStatus();
    boothDiv.style.backgroundColor = status.background;
    boothDiv.style.borderColor     = status.border;
    boothDiv.style.color           = status.text;

    // 4) On click, show a placeholder popup
    boothDiv.addEventListener("click", () => {
      // Placeholder info
      // You can later replace with real data from an API
      const vendorName   = `Vendor ${boothData.label}`;
      const amountOwed   = `$123.45`; 
      const leaseEndDate = `12/31/2025`;
      alert(`Booth: ${boothData.label}\nVendor: ${vendorName}\nAmount Owed: ${amountOwed}\nLease Ends: ${leaseEndDate}`);
    });

    // 5) Append to container
    container.appendChild(boothDiv);
  });
}
</script>
</body>
</html>