<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Visitors Flea Market Rent Collection Map</title>
  <style>
    body {
      margin: 0; 
      padding: 0;
      font-family: sans-serif;
    }

    h1 {
      text-align: center;
      margin: 1rem 0;
    }

    #legend {
      margin: 1rem;
      font-size: 14px;
    }
    #legend h3 {
      margin: 0 0 0.5rem 0;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 0.3rem;
    }
    .color-box {
      width: 20px;
      height: 20px;
      margin-right: 8px;
      border: 2px solid #333; 
      box-sizing: border-box;
    }
    .color-outline-red {
      background-color: #fff;
      border-color: red;
    }

    /* The container for the map plane */
    #mapContainer {
      position: relative;
      margin: 0 auto;
      border: 2px solid #ccc;
      background: #fff;
    }

    /* Booth styling */
    .booth {
      position: absolute;
      border: 2px solid #333; 
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 12px;
      color: #000;
      overflow: hidden; 
      cursor: default; /* read-only example */
    }

    /* Simple tooltip on hover, using data-tooltip attribute */
    .booth:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      top: -40px; 
      left: 0;
      padding: 4px 6px;
      background: rgba(0,0,0,0.8);
      color: #fff;
      font-size: 12px;
      white-space: nowrap;
      pointer-events: none;
      transform: translateY(-100%);
    }
  </style>
</head>
<body>

<h1>Visitors Flea Market Rent Collection Map</h1>

<div id="legend">
  <h3>Legend</h3>
  <div class="legend-item">
    <div class="color-box" style="background-color:red;"></div> 
    <span>Past Due (No Payment This Week)</span>
  </div>
  <div class="legend-item">
    <div class="color-box color-outline-red"></div>
    <span>Past Due (Paid This Week)</span>
  </div>
  <div class="legend-item">
    <div class="color-box" style="background-color:green;"></div>
    <span>Paid This Week, No Past Due</span>
  </div>
  <div class="legend-item">
    <div class="color-box" style="background-color:gray;"></div>
    <span>Vacant Booth</span>
  </div>
  <div class="legend-item">
    <div class="color-box" style="background-color:yellow;"></div>
    <span>Pantry</span>
  </div>
  <div class="legend-item">
    <div class="color-box" style="background-color:lightblue;"></div>
    <span>Company Storage</span>
  </div>
</div>

<div id="mapContainer"></div>

<script>
// We'll fetch the JSON from "map_layout.json"
fetch('map_layout.json')
  .then(response => {
    if(!response.ok){
      throw new Error("Unable to load map_layout.json: " + response.status);
    }
    return response.json();
  })
  .then(mapData => {
    initMap(mapData);
  })
  .catch(err => {
    console.error("Failed to load map_layout.json:", err);
    alert("Error loading map_layout.json. Check console for details.");
  });

// 6 status color sets, matching your legend
const STATUS_COLORS = [
  { background: "red",       border: "#333" },  // Past Due (No Payment)
  { background: "#fff",      border: "red"   }, // Past Due (Paid This Week)
  { background: "green",     border: "#333"  }, // Paid This Week, No Past Due
  { background: "gray",      border: "#333"  }, // Vacant
  { background: "yellow",    border: "#333"  }, // Pantry
  { background: "lightblue", border: "#333"  }  // Company Storage
];

function randomStatus(){
  return STATUS_COLORS[Math.floor(Math.random() * STATUS_COLORS.length)];
}

function initMap(mapData){
  // 1) Set container size from planeWidth & planeHeight
  const container = document.getElementById("mapContainer");
  container.style.width  = mapData.planeWidth + "px";
  container.style.height = mapData.planeHeight+ "px";

  // 2) For each booth in the JSON, create a booth div
  mapData.booths.forEach(b => {
    const boothEl = document.createElement("div");
    boothEl.className = "booth";
    boothEl.style.left   = b.x + "px";
    boothEl.style.top    = b.y + "px";
    boothEl.style.width  = b.width  + "px";
    boothEl.style.height = b.height + "px";
    boothEl.textContent  = b.label;

    // 3) Random status color
    const status = randomStatus();
    boothEl.style.backgroundColor = status.background;
    boothEl.style.borderColor     = status.border;

    // 4) Add a tooltip with placeholder info
    // e.g. "Vendor Name: Vendor #\nLease End: 12/31/2025\nAmount Behind: $123.45"
    const tooltipText = `Vendor Name: Vendor ${b.label}\nLease End: 12/31/2025\nAmount Behind: $123.45`;
    boothEl.setAttribute("data-tooltip", tooltipText);

    // 5) Append to container
    container.appendChild(boothEl);
  });
}
</script>
</body>
</html>