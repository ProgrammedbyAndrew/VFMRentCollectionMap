<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Visitors Flea Market Rent Collection Map</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
    h1 {
      text-align: center;
      margin: 1rem 0;
    }
    #mapContainer {
      position: relative;
      margin: 0 auto;
      border: 2px solid #ccc;
      background: #fff;
    }
    .booth {
      position: absolute;
      border: 2px solid #333;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 12px;
      color: #000;
      overflow: hidden;
      cursor: pointer;
    }
    /* Hover tooltip with occupant_name, etc. */
    .booth:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      top: -60px;
      left: 0;
      padding: 4px 6px;
      background: rgba(0,0,0,0.8);
      color: #fff;
      font-size: 12px;
      white-space: pre; /* so \n becomes line breaks */
      pointer-events: none;
      transform: translateY(-100%);
    }
  </style>
</head>
<body>

<h1>Visitors Flea Market Rent Collection Map</h1>

<!-- We'll build the map with a small inline script using the Jinja data. -->
<div id="mapContainer"
     style="width:{{ planeWidth }}px; height:{{ planeHeight }}px;">
</div>

<script>
// We'll embed the booths as a JS array from Jinja
const booths = JSON.parse(`{{ booths|tojson }}`);

booths.forEach(booth => {
  const container = document.getElementById("mapContainer");
  const div = document.createElement("div");
  div.className = "booth";
  div.style.left = booth.x + "px";
  div.style.top  = booth.y + "px";
  div.style.width= booth.width + "px";
  div.style.height= booth.height + "px";

  div.textContent = booth.label;

  // occupant data
  const occupant = booth.occupant_name || "Vacant";
  const bal      = booth.balance || 0;
  const le_end   = booth.lease_end || "N/A";

  let tooltipText = `${occupant}\n$${bal.toFixed(2)} past due\nLease ends ${le_end}`;
  if(occupant === "Vacant"){
    tooltipText = "Vacant Booth";
  }
  div.setAttribute("data-tooltip", tooltipText);

  div.addEventListener("click", ()=>{
    alert(`Booth ${booth.label}\n${tooltipText}`);
  });

  container.appendChild(div);
});
</script>

</body>
</html>